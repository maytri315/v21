{% extends "base.html" %}
{% block title %}Book Spot - {{ lot.prime_location_name }}{% endblock %}

{% block styles %}
<style>
    .parking-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 15px;
        margin-top: 20px;
    }
    .parking-spot {
        border: 2px solid #ccc;
        border-radius: 8px;
        padding: 15px;
        text-align: center;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .parking-spot.available {
        background-color: #e6ffe6; /* Light green */
        border-color: #28a745; /* Green */
        color: #1a6d2c;
    }
    .parking-spot.occupied {
        background-color: #ffe6e6; /* Light red */
        border-color: #dc3545; /* Red */
        color: #8c2020;
        cursor: not-allowed;
        opacity: 0.7;
    }
    .parking-spot.occupied:hover {
        transform: none; /* Disable hover effect for occupied spots */
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .parking-spot.selected {
        background-color: #cce5ff; /* Light blue */
        border-color: #007bff; /* Blue */
        color: #004085;
        box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.5); /* Blue glow */
    }
    .parking-spot:not(.occupied):hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
</style>
{% endblock %}

{% block content %}
<h2 class="mb-4">Book a Spot in {{ lot.prime_location_name }}</h2>
<div class="card shadow mb-4">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0">Parking Spots</h5>
    </div>
    <div class="card-body">
        <form method="POST" action="{{ url_for('book_spot', lot_id=lot.id) }}">
            <div class="mb-3">
                <label for="hours" class="form-label">Parking Duration (hours)</label>
                <input type="number" step="0.1" class="form-control" id="hours" name="hours" value="1" min="0.1" required>
            </div>
            <div class="parking-grid">
                {% for spot in spots %}
                <div class="parking-spot {{ 'available' if spot.status == 'A' else 'occupied' }}"
                     data-spot-id="{{- spot.id -}}"
                     data-spot-status="{{- spot.status -}}"> {# Removed onclick, added data-spot-status #}
                    Spot {{ spot.id }}
                </div>
                {% endfor %}
            </div>
            <input type="hidden" name="spot_id" id="spot_id">
            <button type="submit" class="btn btn-primary mt-3" id="bookButton" disabled>Book Selected Spot</button>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const parkingSpots = document.querySelectorAll('.parking-spot');
        const hiddenSpotInput = document.getElementById('spot_id');
        const bookButton = document.getElementById('bookButton');

        parkingSpots.forEach(spotElement => {
            spotElement.addEventListener('click', function() {
                const spotId = this.dataset.spotId; // Access data-spot-id
                const spotStatus = this.dataset.spotStatus; // Access data-spot-status

                if (spotStatus === 'O') { // Do not allow selection of occupied spots
                    return;
                }

                // Remove 'selected' class from all spots
                parkingSpots.forEach(s => {
                    s.classList.remove('selected');
                });

                // Add 'selected' class to the clicked spot
                this.classList.add('selected');

                // Set the value of the hidden input
                hiddenSpotInput.value = spotId;

                // Enable the book button
                bookButton.disabled = false;
            });
        });
    });
</script>
{% endblock %}